
BTVirus worm behavior-simulator

This program was made to imitate various smartphone/pocket pc worms by implementing a small set of behaviors which are common to the viruses.  We looked at a few of the well-known viruses and determined that many of them share some of the same capabilities, which are: creating files on the system, scanning for other bluetooth devices, sending files over bluetooth (for spreading), and searching for files on the system (for infection).  The program is structured to make it easy to execute any combination of these behaviors.  A brief description of how the program implements each behavior follows.

Creating files on the system:  Many worms will carry the binary data necessary to re-create themselves on a system, so the program will generate an array of binary data and write it to disk on the device to simulate the behavior of the worm re-creating itself.  As of now the program generates an array of bytes with values 1-256 and then creates an instance of the FileStream class to write the block of data to disk.

Scanning for other bluetooth devices:  The worms we looked at all support spreading over bluetooth, so one necessary function is to be able to scan for other devices.  The program uses the BTAccess.NET library to access the Widcomm bluetooth stack of the device we implemented for.  The BTAccess library implements all of the low-level protocol behavior and provides higher-level functions for things such as scanning, connecting and sending files.  For scanning, a BtDevFoundHandler event handler is created to take over execution once the library functions detect a device.  The scanning is then started by calling the BtStack.StartDeviceSearch() function.  Inside the event handler, lists of device names and BtDevice objects are maintained, and if the discovered device is a new one, it is added to the lists.

Sending files over bluetooth:  Sending copies of itself is crucial for worm spreading, so to implement this behavior we used more built-in functionality of the BTAccess.NET library.  After scanning is complete, if any devices were found then their corresponding BtDevice objects were added to lists.  These BtDevice objects are dequeued one at a time from the list, and the BtDevice.SendFile() function is used to attempt to send a small text file to the target device.

Searching for files on the system:  Some worms will search for specific files on the system, or files ending with certain extensions so that they can append themselves to the file to infect it.  The program searches for files with a given extension by recursively searching through the file system starting from the root directory.  The DirectoryInfo and FileInfo classes from the .NET libraries are used to list subdirectories and files from the current directory.  Any filenames which have matching extensions are added to a list which can be used later to access and alter the target files.